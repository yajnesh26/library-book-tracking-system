<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Library Book Linked List Visualization</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 10px;
    }

    .description {
      text-align: center;
      font-size: 14px;
      margin-bottom: 20px;
      color: #9ca3af;
    }

    .controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .controls label {
      font-size: 14px;
    }

    input[type="file"],
    input[type="number"],
    button {
      padding: 5px 8px;
      border-radius: 6px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #e5e7eb;
      font-size: 13px;
    }

    button {
      cursor: pointer;
    }

    button:hover {
      background: #111827;
    }

    .search-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .visualizer-container {
      background: #020617;
      border-radius: 12px;
      padding: 16px;
      min-height: 150px;
      border: 1px solid #1f2937;
      overflow-x: auto;
      white-space: nowrap;
    }

    .list-info {
      font-size: 13px;
      margin-bottom: 8px;
      color: #9ca3af;
    }

    .nodes-wrapper {
      display: inline-flex;
      align-items: center;
    }

    .book-node {
      background: #1f2937;
      border-radius: 10px;
      padding: 10px 12px;
      min-width: 160px;
      max-width: 200px;
      margin: 5px 0;
      box-shadow: 0 0 0 1px #374151;
      font-size: 12px;
      transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    .book-node-header {
      font-weight: bold;
      margin-bottom: 4px;
      color: #facc15;
    }

    .book-field {
      margin: 2px 0;
    }

    .arrow {
      font-size: 20px;
      margin: 0 8px;
      color: #38bdf8;
    }

    .null-node {
      font-style: italic;
      color: #f97316;
      margin-left: 8px;
      font-size: 14px;
    }

    .error-message {
      color: #f97316;
      font-size: 13px;
      text-align: center;
      margin-top: 8px;
    }

    /* New: highlight searched node */
    .highlight {
      box-shadow: 0 0 0 2px #22c55e, 0 0 12px rgba(34, 197, 94, 0.8);
      transform: scale(1.03);
    }

    /* New: out of stock visual */
    .out-of-stock {
      background: #450a0a;
      box-shadow: 0 0 0 1px #b91c1c;
    }

    .legend {
      text-align: center;
      font-size: 12px;
      margin-top: 8px;
      color: #9ca3af;
    }

    .legend span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      margin: 0 8px;
    }

    .legend-box {
      width: 12px;
      height: 12px;
      border-radius: 3px;
      display: inline-block;
    }
  </style>
</head>
<body>

  <h1>Library Book Linked List Visualization</h1>
  <p class="description">
    Export books from your C program (option 7 → <strong>books.txt</strong>) and load the file here to visualize the linked list.
  </p>

  <div class="controls">
    <label for="fileInput">Choose <strong>books.txt</strong> file:</label>
    <input type="file" id="fileInput" accept=".txt,.csv" />
  </div>

  <!-- New: Search / Highlight controls -->
  <div class="search-controls">
    <label for="searchId">Enter Book ID to highlight:</label>
    <input type="number" id="searchId" placeholder="e.g., 101" />
    <button id="highlightBtn">Highlight Book</button>
  </div>

  <div id="error" class="error-message"></div>

  <div class="visualizer-container">
    <div class="list-info" id="listInfo">No data loaded. List is empty (head = NULL).</div>
    <div class="nodes-wrapper" id="nodesWrapper">
      <!-- Nodes will be inserted here by JavaScript -->
    </div>
  </div>

  <div class="legend">
    <span>
      <span class="legend-box" style="background:#1f2937; box-shadow:0 0 0 1px #374151;"></span>
      Normal book
    </span>
    <span>
      <span class="legend-box" style="background:#450a0a; box-shadow:0 0 0 1px #b91c1c;"></span>
      Out of stock (0 available)
    </span>
    <span>
      <span class="legend-box" style="background:#1f2937; box-shadow:0 0 0 2px #22c55e;"></span>
      Highlighted search result
    </span>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const nodesWrapper = document.getElementById('nodesWrapper');
    const listInfo = document.getElementById('listInfo');
    const errorDiv = document.getElementById('error');
    const searchIdInput = document.getElementById('searchId');
    const highlightBtn = document.getElementById('highlightBtn');

    // store last loaded books globally so we can search them
    let currentBooks = [];

    // When user selects a file (books.txt)
    fileInput.addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();

      reader.onload = function(e) {
        const text = e.target.result;
        try {
          const books = parseBooksFile(text);
          currentBooks = books; // update global
          renderLinkedList(books);
          errorDiv.textContent = '';
        } catch (err) {
          errorDiv.textContent = 'Error reading file: ' + err.message;
          nodesWrapper.innerHTML = '';
          listInfo.textContent = 'Could not load linked list.';
          currentBooks = [];
        }
      };

      reader.onerror = function() {
        errorDiv.textContent = 'Failed to read file.';
      };

      reader.readAsText(file);
    });

    // Parse the CSV-like content from books.txt
    // Format per line: ID,Title,Author,Category,Available,Total
    function parseBooksFile(text) {
      const lines = text.split('\n');
      const books = [];

      for (let line of lines) {
        line = line.trim();
        if (line === '') continue; // skip empty line

        const parts = line.split(',');

        if (parts.length < 6) {
          throw new Error('Invalid line format: "' + line + '"');
        }

        const book = {
          id: parseInt(parts[0]),
          title: parts[1],
          author: parts[2],
          category: parts[3],
          available: parseInt(parts[4]),
          total: parseInt(parts[5])
        };

        books.push(book);
      }

      // Already sorted by bookID from C, but just in case:
      books.sort((a, b) => a.id - b.id);
      return books;
    }

    // Render linked list visually
    function renderLinkedList(books) {
      nodesWrapper.innerHTML = '';

      if (!books || books.length === 0) {
        listInfo.textContent = 'List is empty. (head = NULL)';
        const nullSpan = document.createElement('span');
        nullSpan.className = 'null-node';
        nullSpan.textContent = 'NULL';
        nodesWrapper.appendChild(nullSpan);
        return;
      }

      listInfo.textContent = 'head →';

      books.forEach((book, index) => {
        // Create node
        const nodeDiv = document.createElement('div');
        nodeDiv.className = 'book-node';

        // Mark out-of-stock nodes visually
        if (book.available === 0) {
          nodeDiv.classList.add('out-of-stock');
        }

        // Attach data-id for search highlighting
        nodeDiv.dataset.bookId = book.id;

        const header = document.createElement('div');
        header.className = 'book-node-header';
        header.textContent = `ID: ${book.id}`;
        nodeDiv.appendChild(header);

        const titleDiv = document.createElement('div');
        titleDiv.className = 'book-field';
        titleDiv.textContent = `Title: ${book.title}`;
        nodeDiv.appendChild(titleDiv);

        const authorDiv = document.createElement('div');
        authorDiv.className = 'book-field';
        authorDiv.textContent = `Author: ${book.author}`;
        nodeDiv.appendChild(authorDiv);

        const categoryDiv = document.createElement('div');
        categoryDiv.className = 'book-field';
        categoryDiv.textContent = `Category: ${book.category}`;
        nodeDiv.appendChild(categoryDiv);

        const copiesDiv = document.createElement('div');
        copiesDiv.className = 'book-field';
        copiesDiv.textContent = `Avail/Total: ${book.available}/${book.total}`;
        nodeDiv.appendChild(copiesDiv);

        // Append node
        nodesWrapper.appendChild(nodeDiv);

        // Add arrow if not the last node
        if (index !== books.length - 1) {
          const arrowSpan = document.createElement('span');
          arrowSpan.className = 'arrow';
          arrowSpan.textContent = '→';
          nodesWrapper.appendChild(arrowSpan);
        }
      });

      // Add NULL at the end
      const nullSpan = document.createElement('span');
      nullSpan.className = 'null-node';
      nullSpan.textContent = '→ NULL';
      nodesWrapper.appendChild(nullSpan);
    }

    // Highlight selected book node based on entered ID
    function highlightBookById(id) {
      // Remove old highlights
      const allNodes = nodesWrapper.querySelectorAll('.book-node');
      allNodes.forEach(node => node.classList.remove('highlight'));

      if (!id || isNaN(id)) {
        errorDiv.textContent = 'Please enter a valid Book ID.';
        return;
      }

      // find matching node
      let found = false;
      allNodes.forEach(node => {
        if (parseInt(node.dataset.bookId) === id) {
          node.classList.add('highlight');
          found = true;

          // scroll into view horizontally
          node.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
        }
      });

      if (!found) {
        errorDiv.textContent = `Book with ID ${id} not found in current list.`;
      } else {
        errorDiv.textContent = '';
      }
    }

    // When highlight button is clicked
    highlightBtn.addEventListener('click', () => {
      const id = parseInt(searchIdInput.value);
      highlightBookById(id);
    });

    // Also allow pressing Enter in the input
    searchIdInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const id = parseInt(searchIdInput.value);
        highlightBookById(id);
      }
    });

    // Initial state: show empty list
    renderLinkedList([]);
  </script>

</body>
</html>
